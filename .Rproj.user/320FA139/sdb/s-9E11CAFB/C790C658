{
    "contents" : "source(\"./utils.R\")\nsource(\"./time_align_3_9.R\")\nsource(\"./getMatrixByMag.R\")\nsource(\"./addPCAData.R\")\nsource(\"./plot_debug.R\")\nlibrary(zoo)\n\n# globalacc = getGlobalAccByMag(top)\n# lowpasstop = rollapply(top,5,mean)\n# lowpasstop = as.data.frame(lowpasstop)\n# globalacclp = getGlobalAccByMag(lowpasstop)\n# matplot(cbind(globalacc[1:300,2],globalacclp[1:300,2]),type=\"l\")\n# plot(globalacc[,2],type = \"l\")\n\nmagAngleSmall = c(-5.2535963089,-85.6291941575,-9.6232952834)\nmagAngleLarge = c(-5.2535963089,-5.2535963089,-5.2535963089)\nwindow = 5\nangleResults = matrix(nrow=24,ncol = 6)\npcaCorResults = matrix(nrow=24,ncol = 6)\nfileParent = \"3_10_data\"\nsmallOrLarge = \"large\"\n\ngetAngleSimple = function(mdata,magDrift, tag = \"\", plot3d = F) {\n  globalAcc = getGlobalAccByMag(mdata)[selectIndex,]\n  globalAcc[,3] = 0\n  avgX = mean(globalAcc[,1])\n  avgY = mean(globalAcc[,2])\n  results = c(avgX,avgY,0)\n  angle = 180-(atan2(avgX,avgY)/pi*180)\n  if(angle> 180) angle = angle-360\n  if(angle< -180) angle = angle+360\n#   # sig = getDirection(results, c(0,1,0),c(0,0,1))\n#   if(avgX>0) sig = 1 else sig = -1\n#   angle = sig*angle\n#   angle = angle - magDrift\n  \n  radAngle = angle/180*pi\n  rtm = matrix(c(cos(radAngle), sin(radAngle), 0, -sin(radAngle), cos(radAngle),0, 0, 0, 1),nrow = 3,ncol = 3)\n  pcaGlobal = c()\n  globalAcc =  getGlobalAccByMag(mdata)[selectIndex,]\n  for(i in 1:nrow(globalAcc)){\n    pcaGlobal = rbind(pcaGlobal, rotationByMatrix(globalAcc[i,],rtm))\n  }\n  meanCor = 0\n  for(i in 1:2){\n    meanCor = meanCor + cor(pcaGlobal[,i],globalAcc[,i])\n  }\n  meanCor = meanCor/2\n  print(paste(tag,\"pca_mag_cor:\",meanCor))\n  \n  return(c(angle,meanCor))\n}\n\naddResults = function(results,path,i,deviceNum){\n  angleResults[(path-1)*8+i,deviceNum] <<- results[1]; \n  pcaCorResults[(path-1)*8+i,deviceNum] <<- results[2]; \n  deviceNum<<- deviceNum+1\n}\n\nfor(smallOrLarge in c(\"small\")){\n  for(window in c(15)){\n    selectIndex <<- 1:(50*window)\n    \n    if(smallOrLarge == \"large\") {\n      pathIndex <<- 4:6\n    }else{\n      pathIndex <<- 1:3\n    }\n    \n    for(path in pathIndex){\n      for(i in 1:8){\n        \n        print(paste(smallOrLarge,\"window:\",window,\"path\",path,\"i\",i,\"--------------------------------\"))\n        \n        readSample(path, i, s, e)\n        \n        addDeviceDataToPCA = addDeviceDataToPCA2\n        \n        gacctop = getGlobalAccByMag(top)\n        \n        \n        deviceNum = 1\n        \n        if(smallOrLarge == \"large\") {\n          rowIndex = path-3 \n          magDrift = magAngleLarge[rowIndex]\n        }\n        else {\n          rowIndex = path\n          magDrift = magAngleSmall[rowIndex]   \n        }\n        results = getAngleSimple(glass,magDrift, \"glass\",F); addResults(results,rowIndex,i,deviceNum); \n        results = getAngleSimple(top,magDrift, \"top\",F); addResults(results,rowIndex,i,deviceNum);\n        results = getAngleSimple(leftHand,magDrift, \"leftHand\",F); addResults(results,rowIndex,i,deviceNum); \n        results = getAngleSimple(rightHand, magDrift,\"rightHand\",F); addResults(results,rowIndex,i,deviceNum); \n        results = getAngleSimple(leftPants, magDrift,\"leftPants\",F); addResults(results,rowIndex,i,deviceNum); \n        results = getAngleSimple(rightPants,magDrift, \"rightPants\",F);addResults(results,rowIndex,i,deviceNum); \n      }\n    }\n    angleResults = as.data.frame(angleResults);names(angleResults) = c(\"glass\",\"top\",\"lefthand\",\"righthand\",\"leftpants\",\"rightpants\")\n    pcaCorResults = as.data.frame(pcaCorResults);names(pcaCorResults) = c(\"glass\",\"top\",\"lefthand\",\"righthand\",\"leftpants\",\"rightpants\")\n    write.csv(angleResults,paste(\"./summary_avg/angleResults_\",smallOrLarge,\"_\",window,\".csv\",sep = \"\"),row.names = F)\n    write.csv(pcaCorResults,paste(\"./summary_avg/pcaCorResults_\",smallOrLarge,\"_\",window,\".csv\",sep = \"\"),row.names = F)\n    print(angleResults)\n    print(pcaCorResults)\n  }\n}\n\n\n\n",
    "created" : 1458009814041.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "516602806",
    "id" : "C790C658",
    "lastKnownWriteTime" : 1458021448,
    "path" : "~/workspace/R/multidevicealign/exp_avg.R",
    "project_path" : "exp_avg.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 7,
    "source_on_save" : false,
    "type" : "r_source"
}