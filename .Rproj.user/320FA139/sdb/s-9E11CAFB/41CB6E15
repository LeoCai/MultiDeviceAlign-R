{
    "contents" : "source(\"./utils.R\")\nsource(\"./time_align_3_11_car.R\")\nsource(\"./getMatrixByMag.R\")\nsource(\"./addPCAData.R\")\nsource(\"./plot_debug.R\")\nlibrary(zoo)\n\n# globalacc = getGlobalAccByMag(top)\n# lowpasstop = rollapply(top,5,mean)\n# lowpasstop = as.data.frame(lowpasstop)\n# globalacclp = getGlobalAccByMag(lowpasstop)\n# matplot(cbind(globalacc[1:300,2],globalacclp[1:300,2]),type=\"l\")\n# plot(globalacc[,2],type = \"l\")\n\nmagAngleSmall = c(-5.2535963089,-85.6291941575,-9.6232952834)\nmagAngleLarge = c(-5.2535963089,-5.2535963089,-5.2535963089)\nwindow = 5\nangleResults = matrix(nrow=24,ncol = 6)\npcaCorResults = matrix(nrow=24,ncol = 6)\nfileParent = \"3_11_car\"\nsmallOrLarge = \"large\"\n\ngetAngleSimple = function(mdata,magDrift, tag = \"\", plot3d = F) {\n  globalAcc = getGlobalAccByMag(mdata)[selectIndex,]\n  globalAcc[,3] = 0\n  # matplot(cbind(Fc[1:150],globalAcc[1:150,2]),type = \"l\",main = paste(tag, \"fc_fi\"))\n  Fi = globalAcc\n  tr = 0.01; results = c()\n  dimStr = c(\"x\",\"y\",\"z\")\n  for (dim in 1:3) {\n    # mean = 0;count = 0\n    fiFc = c()\n    EFi = mean(Fi[,dim])\n    EFc = mean(Fc)\n    print(paste(EFi,EFc))\n    meanR = EFi / EFc\n    results = c(results,meanR)\n  }\n  angle = computeAngle(results,c(0,1,0))\n  sig = getDirection(results, c(0,1,0),c(0,0,1))\n  angle = sig*angle\n  angle = angle - magDrift\n  print(tag)\n  # print(results)\n  # print(angle)\n  if (plot3d) {\n    init3d(tag)\n    myArrow3d(results * 4,2)\n    for (i in 1:nrow(globalAcc)) {\n      myArrow3d(globalAcc[i,])\n    }\n  }\n  \n  radAngle = angle/180*pi\n  rtm = matrix(c(cos(radAngle), sin(radAngle), 0, -sin(radAngle), cos(radAngle),0, 0, 0, 1),nrow = 3,ncol = 3)\n  pcaGlobal = c()\n  globalAcc =  getGlobalAccByMag(mdata)[selectIndex,]\n  for(i in 1:nrow(globalAcc)){\n    pcaGlobal = rbind(pcaGlobal, rotationByMatrix(globalAcc[i,],rtm))\n  }\n  meanCor = 0\n  for(i in 1:2){\n    meanCor = meanCor + cor(pcaGlobal[,i],globalAcc[,i])\n  }\n  meanCor = meanCor/2\n  print(paste(tag,\"pca_mag_cor:\",meanCor))\n  \n  return(c(angle,meanCor))\n  \n}\n\naddResults = function(results,path,i,deviceNum){\n  angleResults[(path-1)*8+i,deviceNum] <<- results[1]; \n  pcaCorResults[(path-1)*8+i,deviceNum] <<- results[2]; \n  deviceNum<<- deviceNum+1\n}\n\n\nwindow = 2\nselectIndex <<- 1:(50*window)\n\npath = 7\ni = 1\nreadSample(path, i, s, e)\n\naddDeviceDataToPCA = addDeviceDataToPCA2\n\ngacctop = getGlobalAccByMag(top)\n\ncomputeFc = function() {\n  pcaData <<- c()\n  addDeviceDataToPCA(top,\"top\")\n  addDeviceDataToPCA(leftHand,\"leftHand\")\n  addDeviceDataToPCA(rightHand,\"rightHand\")\n  addDeviceDataToPCA(rightPants,\"rightPants\")\n  addDeviceDataToPCA(leftPants,\"leftPants\")\n  # write.csv(pcaData,\"./summary_fi_fc_pca_angle_cor/pcaData.csv\",row.names = F)\n  epca6A <- prcomp(pcaData,\n                   center = F,\n                   scale. = F)\n  print(epca6A$sdev^2)\n  # plot(epca6A$sdev,type = \"l\" ,main = \"egvalue\")\n  newData = predict(epca6A, newdata = pcaData)\n  pcaForward = -newData[selectIndex,1]\n  if(abs(min(pcaForward))<abs(max(pcaForward))) pcaForward = -pcaForward\n  plot(pcaForward[1:100],type=\"l\",main=\"Fc\",ylim=c(-2,2))\n  return(pcaForward)\n}\n\nFc = computeFc()\n\nmagDrift = magAngleSmall[1]\ngetAngleSimple(top,magDrift, \"top\",F)\ngetAngleSimple(leftHand,magDrift, \"leftHand\",F)\ngetAngleSimple(rightHand, magDrift,\"rightHand\",F)\ngetAngleSimple(leftPants, magDrift,\"leftPants\",F)\ngetAngleSimple(rightPants,magDrift, \"rightPants\",F)\n\n\n\n",
    "created" : 1457772986451.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2772019661",
    "id" : "41CB6E15",
    "lastKnownWriteTime" : 1457831973,
    "path" : "~/workspace/R/multidevicealign/car_test_pca.R",
    "project_path" : "car_test_pca.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "type" : "r_source"
}